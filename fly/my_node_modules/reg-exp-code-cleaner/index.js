/**
 * Created by Dmitry Turovtsov
 */

/*global require, module, Buffer */
var through = require('through2'),
	gutil = require('gulp-util');

var PLUGIN_NAME = 'reg-exp-code-cleaner';

module.exports = function (options) {

	"use strict";

	return through.obj(function (file, encoding, callback) {

		if (file.isNull()) {
			return callback(null, file);
		}

		if (file.isStream()) {
			return callback(new gutil.PluginError(PLUGIN_NAME, 'doesn\'t support Streams'));
		}

		var filesString = file.contents.toString();

		// work with file here
		options.re.forEach(function (data) {
			filesString = filesString.replace(data.re, data.replace);
		});

		file.contents = new Buffer(filesString, encoding);

		callback(null, file);

	});

};
